# 1. JVM

**todo-star.**

## 1.1 JVM 이란

JVM(java vritual machine)은 컴파일러에 의해 생성된 클래스 파일을 해석하고 실행하는 가상의 CPU로
class의 바이트코드를 실제 CPU가 실행하는 2진 코드로 변환하여 CPU에 전달해주는 역활을 한다.

* JVM과 같이 중간 언어(바이트코드)를 해석해주는 추상화된 장치가 없다면 운영체제마다 실행가능한 프로그램을 만들어주어야 했는데,
Java는 바이트코드를 기계어로 한번 더 번역하는 과정을 통해서 플랫폼에 독립적으로 실행가능하게 되었다.

## 1.2 컴파일 하는 방법

java.exe 를 통해서 바이트코드로 변환한다. 이때 실행하는 명령어는 cmd 창에서 다음과같이 실행해주면 된다.
그러면 JVM이 해석가능한 클래스 파일이 생성된다.

```text
javac 파일명.java
javac HelloWorld.java
```

* JDK 자바 개발 도구를 설치하면 bin 폴더안의 javac라는 자바 컴파일러가 포함되어 있다. 이를 환경변수를 지정해서 해당 명령어를 사용할수 있다.

## 1.3 실행 하는 방법

java.exe 를 통해 JVM에게 바이트코드를 넘겨주고 이는 2진 코드로 변환이 된다. 그러면 이제 CPU가 읽을수 있게 된다.
실행 방법은 다음과 같은 명령어를 입력하면 된다. 이때 클래스 파일명만 입력해주면 된다.(.class - X)

```text
java 파일명.class
java HelloWorld
```

* 자바 14로 컴파일한 class 파일을 하위버전인 자바 8로 실행할수 없다. 즉, 상위 버전의 바이트코드는 한위버전에서 실행할수 없다. 단, 하위버전의 바이트코드는 상위버전에서 실행할수 있다. (UnsupportedClassVersionError 발생) 이때 하위 버전에서 실행을 하게하려면 자바 14로 컴파일시 옵션(javac ... -sourcing 1.8 target 1.8) 을 주면 된다. 하지만 하위버전의 바이트코드를 지원한다는것은 성능, 최적화 부분에서 부족할것이다.

## 1.4 바이트코드란 무엇인가

자바와 같은 고급언어를 가상머신이 이해할수 있는 코드로 변환한것을 의미한다.
그러면 이 변환한것은 각각의 플랫폼에 맞는 가상머신에 의해 기계어로 컴파일된다.

* 클래스 파일을 javap 로 실행하면 해석이 된 바이트코드를 볼수가 있디.

## 1.5 JIT 컴파일러 란 무엇 이며 어떻게 동작하는가

Just in time의 약자로 프로그램이 실행중인 런타임 시점에 기계어로 변환해준다.
자바 인터프리터 방식의 단점을 보완하기 위해 나온 개념이며 필요한 부분을 캐시하여 재사용시 다시 컴파일 하지 않는다.

* 바이트코드를 기계어로 번역할때 자주 반복되는 부분을 기계어로 캐시하여 바로 실행한다.

## 1.6 JVM 구성 요소

JVM은 4가지 구성요소로 되어있다.

1. Class Loader: 동적으로 클래스를 읽어올때 클래스를 로딩해준다.
2. GC(Garbage Collector): 더 이상 사용하지 않는 메모리를 자동으로 회수해준다. (Execution Engine 내부에 존재)
3. Execution Engine: 클래스 로더에 의해 데이터 영역에 바이트코드가 배치가 되고 이를 실행하는 부분에 해당한다.
4. RunTime Data Area: OS에게 할당 받은 메모리 공간으로 각각 쓰레드가 할당된다. 이는 크게 PC Register(쓰레드가 생성될때마다 생성되며, CPU가 명령을 수행할때 필요한 정보가 저장된다.), JVM Stack(메소드의 정보가 저장된다.),  Native Method Stack(Java 가 아닌 다른 Native 언어를 위해 제공되는 영약이다.), Method Area(모든 쓰레드가 공유하는 영역으로 공통으로 필요한 정보들이 저장된다-클래스, static 등), Heap(객체를 저장하는 가상 공간) 으로 구성된다.

## 1.7 JDK 와 JRE 의 차이

Java Development Kit 의 약자로 자바 개발에 필요한 개발 도구를 모아놓은것이다. 여기에 JRE 가 포함되어 있으며
JRE 는 Java Runtime Environment 의 약자로 자바 파일을 실행하주도록 도와주는 역활을 한다.

* 자바9 이후부터는 JRE를 더 이상 만들지 않는다고 한다. (JDK에 포함되기 때문)
